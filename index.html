async handleLogin() {
    const apiKey = this.apiKeyInput.value.trim();
    
    try {
        // Validate API key format
        if (!this.validateApiKey(apiKey)) {
            throw new Error('Invalid API key format. Please enter a valid Torn City API key.');
        }

        // Try basic info first
        const basicInfo = await this.fetchBasicInfo(apiKey);
        
        // Show username immediately after successful API call
        this.showUsername(basicInfo.name);
        
        // Update user info
        this.updateUserInfo(basicInfo);
        
        // Fetch and display statistics
        await this.fetchStatistics(apiKey);
        
        // Show success message
        this.showSuccess('Logged in successfully!');
        
        // Show statistics page
        this.loginForm.classList.add('hidden');
        this.statsContainer.classList.remove('hidden');
        
    } catch (error) {
        this.showError(error.message);
    }
}

// Add this new method to show username
showUsername(name) {
    const usernameDiv = document.getElementById('username');
    usernameDiv.textContent = `Welcome, ${name}!`;
    usernameDiv.style.display = 'block';
}

// Add this to your HTML, right after the login form:
<div id="username" style="display: none; text-align: center; margin-top: 10px; color: #4CAF50; font-weight: bold;"></div>